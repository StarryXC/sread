# Gradle

## 依赖管理

```
repositories
dependencies
	implementation compile
	api compile
	provided compileOnly
	annotationProcessor apt
	testImplementation testCompile
	androidTestImplementation androidTestCompile

Maven Urls
https://jitpack.io
maven { url "https://maven.aliyun.com/repository/public" }
maven { url "https://maven.aliyun.com/repository/google" }
maven { url "https://maven.aliyun.com/repository/jcenter" }
maven { url "file://D:/adsf/hubtest" }
maven { url "http://maven.aliyun.com/nexus/content/groups/public/" }
maven { url 'https://maven.google.com/' name 'Google'}

repositories {
    maven { name "" url "" }
    google()
    jcenter()
    mavenCentral()
    mavenLocal()
}

dependencies {
    implementation fileTree(include: ['*.jar'], dir: 'libs')
    implementation project(':app')
    implementation (name: 'LogMap2-1.0.0', ext: 'aar') {
        exclude module:'LoopViewPager.class'
        exclude group: 'com.android.support', module: 'support-annotations'
    }
}

```

```

```

```

```

```

```

```

```

```

```

```

```

# Gradle - Plugin

## Android

```
plugins
    id ''
    id ''

android
    compileSdkVersion
    buildToolsVersion
    defaultConfig
    compileOptions
    sourceSets

defaultConfig
    minSdkVersion
    targetSdkVersion

compileOptions
    sourceCompatibility JavaVersion.VERSION_1_7
    targetCompatibility JavaVersion.VERSION_1_7

sourceSets
        main {
            dirs.each { dir ->
                java.srcDirs "src/${dir}/java"
                res.srcDirs "src/${dir}/res"
            }
        }
        androidTest.setRoot('tests')
        androidTest.java.srcDirs = ['tests/src']

android {
    compileSdk 28
    compileSdkVersion "29.0.2"
    defaultConfig {
        applicationId "env.app"
        minSdk 23
        targetSdk 28
        versionCode 1
        versionName "1.0"
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
}
android {
    useLibrary 'org.apache.http.legacy'
}
android {
    signingConfigs {
        signConfig {
            storeFile file("./bitong.keystore")
            storePassword "bitong2018"
            keyAlias "bitong"
            keyPassword "bitong2018"
        }
    }
    buildTypes {
        release {
            signingConfig signingConfigs.signConfig
            minifyEnabled false // 混淆
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
            buildConfigField "boolean", "LO", "true"
            shrinkResources true // 移除无用的resource文件
            zipAlignEnabled true // Zipalign 优化
            versionNameSuffix "-deb2ug"
        }
        debug {
            signingConfig signingConfigs.signConfig
        }
    }
    lintOptions {
        checkReleaseBuilds false
        abortOnError false // 忽略lint错误
        disable "InvalidPackage"
        // lintConfig file("lint.xml")
    }
    dexOptions {
        javaMaxHeapSize "4g"
    }
    packagingOptions {
        exclude 'META-INF/DEPENDENCIES'
        exclude 'META-INF/NOTICE'
        exclude 'META-INF/LICENSE'
        exclude 'META-INF/LICENSE.txt'
        exclude 'META-INF/NOTICE.txt'
        pickFirst "androidx/viewpager/widget/LoopViewPager.class"
    }
    sourceSets {
        main {
            jniLibs.srcDirs = ['libs'] // jnilib so文件目录
            java.srcDirs = ['src/main/java']
            resources.srcDirs = ['src/main/res']
            aidl.srcDirs = ['src/main/aidl']
            renderscript.srcDirs = ['src/main/rs']
            res.srcDirs = ['src/main/res']
            assets.srcDirs = ['src/main/assets']
            shaders.srcDirs = ['src/main/shaders']
            manifest.srcFile 'AndroidManifest.xml'
            androidTest.setRoot('androidTest')
            debug.setRoot('build-types/debug')
            release.setRoot('build-types/release')
            jni.srcDirs = []
        }
    }
}
android {
    defaultConfig {
        ndk {
            //选择要添加的对应cpu类型的.so库。
            abiFilters 'armeabi', 'armeabi-v7a', 'arm64-v8a', 'x86', 'x86_64', 'mips', 'mips64'
        }
        externalNativeBuild {
            cmake {
                cppFlags "-std=c++11"
                abiFilters 'armeabi'
                arguments "-DANDROID_STL=gnustl_static"
            }
        }
    }
    externalNativeBuild {
        cmake {
            path "CMakeLists.txt"
        }
    }
}
android {
    defaultConfig {
        multiDexEnabled true
    }
}
android {
    defaultConfig {
        consumerProguardFiles 'consumer-rules.pro'
        manifestPlaceholders = [
                UMENG_APPKEY: "5b67faa3f43e48518600021a",
                UMENG_CHANNEL: "bitong"
        ]
    }
}
android {
    dataBinding{
        enabled=true
    }
}
dependencies { // androidx
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation 'androidx.appcompat:appcompat:1.1.0'
    implementation 'com.google.android.material:material:1.1.0'
    implementation 'androidx.constrainntlayout:1.1.3'
    testImplementation 'junit:junit:4.12'
    androidTestImplementation 'androidx.test.ext:junit:1.1.1'
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.2.0'
}
dependencies { // support
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation 'com.android.support:appcompat-v7:28.0.0' # appcompat-v7 design recyclerview-v7 percent cardview-v7 support-v4
    implementation 'com.android.support:design:28.0.0'
    implementation 'com.android.support.constraint:constraut:1.1.3'
    testImplementation 'junit:junit:4.12'
    androidTestImplementation 'com.android.support.test:runner:1.0.2'
    androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'
}
android {
    flavorDimensions 'default'
    productFlavors {
        ask {
            applicationId ''
            dimension 'cover'
            manifestPlaceholders = [
                    MAIN_AC:"visit.health.patient.main.MainActivity",
                    APP_NAME:"@string/app_name_patient"
            ]
        }
        brain {
            applicationId ''
            dimension 'cover'
            manifestPlaceholders = [
                    MAIN_AC:"visit.health.patient.main.MainActivity",
                    APP_NAME:"@string/app_name_patient"
            ]
        }
    }
}
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="org.note.myapplication">
    <application>
        <uses-library android:name="android.test.runner"/>
    </application>
    <instrumentation
        android:name="android.test.InstrumentationTestRunner"
        android:label="Tests"
        android:targetPackage="org.note.myapplication" />
</manifest>
android {
    compileSdkVersion 23
    buildToolsVersion "29.0.2"
    defaultConfig {
        applicationId ''
        testInstrumentationRunner "android.test.InstrumentationTestRunner"
    }
}
dependencies { // test
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation 'com.android.support:appcompat-v7:23.3.0' # 23.4.0
    testImplementation 'junit:junit:4.12'
}

project.compileSdkVersion as int
resourcePrefix 'machine_'
```

## Kotlin

```

```

## Kotlin Android

```
org.jetbrains.kotlin # classpath ext.kotlin_version = '1.3.50'
	kotlin-gradle-plugin:$kotlin_version

kotlin-android kotlin-android-extensions kotlin-kapt
android
	kotlinOptions # jvmTarget = '1.8'

org.jetbrains.kotlin
	kotlin-stdlib
	kotlin-stdlib-jdk7 kotlin-stdlib-jdk8
androidx.core:core-ktx:1.2.0

implementation "org.jetbrains.kotlin:kotlin-stdlib-jre7:$kotlin_version"
implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"
implementation "org.jetbrains.kotlin:kotlin-stdlib-jre7:$kotlin_version"
androidx.core:core-ktx:1.0.2

plugins {
    id 'com.android.application'
    id 'kotlin-android'
    id 'kotlin-android-extensions'
    id 'kotlin-kapt'
}

android {
    kotlinOptions {
        jvmTarget = '1.8'
    }
}
classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.6'
        classpath 'com.github.dcendents:android-maven-gradle-plugin:1.4.1'
        classpath 'me.xx2bab.gradle:seal-manifest-precheck-plugin:1.1.0'
```

## Maven

```
gradlew uploadArchives

plugins {
    id 'java'
    id 'maven'
}
java {
    sourceCompatibility = JavaVersion.VERSION_1_7
    targetCompatibility = JavaVersion.VERSION_1_7
}
// 会将源码上传到私服
task sourceJar (type:Jar) {
    classifier = 'sources'
    from sourceSets.main.allSource
}
artifacts {
    archives sourceJar
}
uploadArchives {
    repositories {
        mavenDeployer {
            pom {
                groupId = "yes.ican.logmap-android" // 唯一标识（通常为模块包名，也可以任意）
                artifactId = "LogMap" // 项目名称（通常为类库模块名称，也可以任意）
                version = "1.0.0" // 版本号
                packaging = "aar"
                project {
                    name  'viewlibrary'
                    groupId  'secondriver'
                    artifactId  'viewlibrary'
                    version  '1.2.0'
                    packaging  'aar'
                    licenses {
                        license {
                            name  'The Apache Software License, Version 2.0'
                            url  'http://www.apache.org/licenses/LICENSE-2.0.txt'
                            distribution  'repo'
                        }
                    }
                    developers {
                        developer {
                            id  'secondriver'
                            name  'secondriver'
                        }
                    }
                }
            }
            // url:  'maven.repo.local'
            //
            repository(url: uri('libs')) { // 配置本地仓库路径
                authentication(userName: '账号', password: '密码')
            }
            snapshotRepository(url: uri('libs')) { // 私服快照地址
                authentication(userName: '账号', password: '密码')
            }
        }
    }
}

task uploadLocal(type: Upload) {
    // 需要把config设置成project的，要不然会报错
    configuration = project.configurations.findByName('archives')
    repositories {
        mavenDeployer {
            repository(url: uri('C:/Users/Developer/Desktop/StarryAndroidSupport/repo'))
            pom.groupId = "czw.starry"// 唯一标识（通常为模块包名，也可以任意）
            pom.artifactId = "starry-java" // 项目名称（通常为类库模块名称，也可以任意）
            pom.version = "1.0.0" // 版本号
        }
    }
}
uploadArchives.dependsOn uploadLocal
```

## Android Maven

```
com.github.dcendents # classpath
	android-maven-gradle-plugin:1.5

com.github.dcendents.android-maven
group='com.ert.asdf'
```

## Java

```
apply plugin: 'java'
dependencies {}
implementation fileTree(include: ['*.jar'], dir: 'libs')
sourceCompatibility = "7"
targetCompatibility = "7"

:java # 
sourceCompatibility # = JavaVersion.VERSION_1_7
targetCompatibility
dependencies # implementation fileTree(dir: 'libs', include: ['*.jar'])

java-library
:java-library
java
	sourceCompatibility
	targetCompatibility

apply plugin: 'java'
```

## Gradle

```
apply plugin: 'groovy'

dependencies {
    implementation gradleApi()
    implementation localGroovy()
}
repositories {
    mavenCentral()
}
```

```

```

```

```

```

```

```

```

# Maven

## 依赖管理

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

```

